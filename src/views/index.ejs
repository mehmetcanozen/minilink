<!-- Enhanced Home Page -->
<div class="hero">
    <div class="hero-content">
        <h1 class="hero-title">
            Shorten URLs with <span class="gradient-text">MiniLink</span>
        </h1>
        <p class="hero-subtitle">
            Create short, memorable links instantly. Track clicks, manage expiration, and get detailed analytics.
        </p>
        
        <!-- Feature Badges -->
        <div class="hero-features">
            <div class="feature-badge">
                <i class="fas fa-bolt"></i>
                <span>Lightning Fast</span>
            </div>
            <div class="feature-badge">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </div>
            <div class="feature-badge">
                <i class="fas fa-clock"></i>
                <span>Expiration</span>
            </div>
            <div class="feature-badge">
                <i class="fas fa-shield-alt"></i>
                <span>Secure</span>
            </div>
        </div>
    </div>

    <!-- URL Shortening Form -->
    <div class="url-form-container">
        <div class="url-form enhanced">
            <div class="form-header">
                <h2 class="form-title">Shorten Your URL</h2>
                <p class="form-subtitle">Enter a long URL to create a short, shareable link</p>
            </div>

            <form id="urlForm" class="enhanced-form">
                <div class="form-group">
                    <label for="originalUrl" class="form-label">
                        <i class="fas fa-link"></i>
                        Long URL
                    </label>
                    <div class="input-group enhanced">
                        <div class="input-prefix">
                            <i class="fas fa-globe"></i>
                        </div>
                        <input 
                            type="url" 
                            id="originalUrl" 
                            name="originalUrl" 
                            class="form-input enhanced" 
                            placeholder="https://example.com/very-long-url-that-needs-shortening"
                            required
                        >
                        <button type="submit" class="btn btn-primary enhanced" id="shortenBtn">
                            <i class="fas fa-cut"></i>
                            Shorten
                        </button>
                    </div>
                </div>

                <!-- Expiration Options -->
                <div class="expiration-options">
                    <label class="form-label">
                        <i class="fas fa-clock"></i>
                        Expiration (Optional)
                    </label>
                    <div class="expiration-grid">
                        <div class="form-check enhanced">
                            <input type="radio" name="expiration" value="1min" id="exp1min" class="form-check-input" checked>
                            <label for="exp1min" class="form-check-label">
                                <div class="check-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="check-content">
                                    <div class="check-title">1 Minute</div>
                                    <div class="check-subtitle">Expires in 1 minute</div>
                                </div>
                            </label>
                        </div>
                        
                        <div class="form-check enhanced">
                            <input type="radio" name="expiration" value="1h" id="exp1h" class="form-check-input">
                            <label for="exp1h" class="form-check-label">
                                <div class="check-icon">
                                    <i class="fas fa-hourglass-half"></i>
                                </div>
                                <div class="check-content">
                                    <div class="check-title">1 Hour</div>
                                    <div class="check-subtitle">Expires in 1 hour</div>
                                </div>
                            </label>
                        </div>

                        <div class="form-check enhanced">
                            <input type="radio" name="expiration" value="1d" id="exp1d" class="form-check-input">
                            <label for="exp1d" class="form-check-label">
                                <div class="check-icon">
                                    <i class="fas fa-calendar-day"></i>
                                </div>
                                <div class="check-content">
                                    <div class="check-title">1 Day</div>
                                    <div class="check-subtitle">Expires in 24 hours</div>
                                </div>
                            </label>
                        </div>
                        
                        <div class="form-check enhanced">
                            <input type="radio" name="expiration" value="1w" id="exp1w" class="form-check-input">
                            <label for="exp1w" class="form-check-label">
                                <div class="check-icon">
                                    <i class="fas fa-calendar-week"></i>
                                </div>
                                <div class="check-content">
                                    <div class="check-title">1 Week</div>
                                    <div class="check-subtitle">Expires in 7 days</div>
                                </div>
                            </label>
                        </div>
                        
                        <div class="form-check enhanced">
                            <input type="radio" name="expiration" value="1m" id="exp1m" class="form-check-input">
                            <label for="exp1m" class="form-check-label">
                                <div class="check-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="check-content">
                                    <div class="check-title">1 Month</div>
                                    <div class="check-subtitle">Expires in 30 days</div>
                                </div>
                            </label>
                        </div>
                    </div>


                </div>

                <div class="form-footer">
                    <div class="form-benefits">
                        <div class="benefit-item">
                            <i class="fas fa-chart-line"></i>
                            <span>Real-time analytics</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-shield-alt"></i>
                            <span>Secure & reliable</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Mobile optimized</span>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" id="loadingState" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
            </div>
            <h3 class="loading-title">Creating your short URL...</h3>
            <p class="loading-subtitle">This will only take a moment</p>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Result -->
    <div class="success-card enhanced" id="successCard" style="display: none;">
        <div class="success-header">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="success-title">URL Shortened Successfully!</h3>
            <p class="success-subtitle">Your link is ready to share</p>
        </div>
        
        <div class="url-result enhanced">
            <div class="url-display">
                <label class="url-label">Your Short URL</label>
                <input type="text" id="shortUrlResult" readonly>
                <button type="button" class="copy-btn enhanced" id="copyBtn" onclick="copyToClipboard()">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
            
            <div class="url-actions">
                <a href="#" id="visitUrlBtn" target="_blank" class="btn btn-secondary">
                    <i class="fas fa-external-link-alt"></i>
                    Visit URL
                </a>
                <button type="button" class="btn btn-outline" onclick="generateQRCode()">
                    <i class="fas fa-qrcode"></i>
                    QR Code
                </button>
                <a href="#" id="statsUrlBtn" class="btn btn-outline">
                    <i class="fas fa-chart-line"></i>
                    View Stats
                </a>
            </div>
            
            <div class="url-meta">
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span>Created: <span id="createdTime"></span></span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-mouse-pointer"></i>
                    <span>Clicks: <span id="clickCount">0</span></span>
                </div>
                <div class="expiration-info" id="expirationInfo" style="display: none;">
                    <i class="fas fa-hourglass-end"></i>
                    <span>Expires: <span id="expirationTime"></span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Section -->
    <div class="error-section" id="errorSection" style="display: none;">
        <div class="alert enhanced" id="errorAlert">
            <div class="error-header">
                <div class="error-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h4 class="error-title" id="errorTitle">Error</h4>
            </div>
            <p class="error-message" id="errorMessage"></p>
        </div>
    </div>
</div>

<!-- Features Section -->
<section class="features-section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Why Choose MiniLink?</h2>
            <p class="section-subtitle">Professional URL shortening with advanced features</p>
        </div>
        
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-tachometer-alt"></i>
                </div>
                <h3 class="feature-title">Lightning Fast</h3>
                <p class="feature-description">Generate short URLs in milliseconds with our optimized infrastructure.</p>
                <div class="feature-stats">
                    <div class="stat">
                        <span class="stat-value">&lt;100ms</span>
                        <span class="stat-label">Response Time</span>
                    </div>
                </div>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3 class="feature-title">Real-time Analytics</h3>
                <p class="feature-description">Track clicks, monitor performance, and get detailed insights instantly.</p>
                <div class="feature-stats">
                    <div class="stat">
                        <span class="stat-value">Live</span>
                        <span class="stat-label">Data Updates</span>
                    </div>
                </div>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <h3 class="feature-title">URL Expiration</h3>
                <p class="feature-description">Set custom expiration dates for temporary links and automatic cleanup.</p>
                <div class="feature-stats">
                    <div class="stat">
                        <span class="stat-value">Auto</span>
                        <span class="stat-label">Cleanup</span>
                    </div>
                </div>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h3 class="feature-title">Secure & Reliable</h3>
                <p class="feature-description">Enterprise-grade security with 99.9% uptime and data protection.</p>
                <div class="feature-stats">
                    <div class="stat">
                        <span class="stat-value">99.9%</span>
                        <span class="stat-label">Uptime</span>
                    </div>
                </div>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <h3 class="feature-title">Mobile Optimized</h3>
                <p class="feature-description">Perfect experience on all devices with responsive design.</p>
                <div class="feature-stats">
                    <div class="stat">
                        <span class="stat-value">100%</span>
                        <span class="stat-label">Responsive</span>
                    </div>
                </div>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-code"></i>
                </div>
                <h3 class="feature-title">Developer Friendly</h3>
                <p class="feature-description">RESTful API with comprehensive documentation and SDKs.</p>
                <div class="feature-stats">
                    <div class="stat">
                        <span class="stat-value">API</span>
                        <span class="stat-label">Ready</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Recent URLs Section -->
<section class="recent-section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Recently Created URLs</h2>
            <p class="section-subtitle">Your latest shortened links</p>
        </div>
        
        <div class="recent-urls-container">
            <div id="recentUrlsContainer" class="loading-placeholder">
                <div class="spinner"></div>
                <div class="loading-text">Loading recent URLs...</div>
            </div>
        </div>
    </div>
</section>

<!-- QR Code Modal -->
<div class="modal" id="qrModal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="fas fa-qrcode"></i>
                QR Code
            </h3>
            <button class="modal-close" onclick="closeQRModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="qr-container">
                <div class="qr-code" id="qrCodeDisplay"></div>
                <p class="qr-text">Scan to access your shortened URL</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="downloadQRCode()">
                <i class="fas fa-download"></i>
                Download QR Code
            </button>
            <button class="btn btn-outline" onclick="closeQRModal()">
                Close
            </button>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<script>
// Enhanced URL Shortening JavaScript
class URLShortener {
    constructor() {
        this.initializeElements();
        this.bindEvents();
        this.loadRecentUrls();
    }

    initializeElements() {
        this.form = document.getElementById('urlForm');
        this.loadingState = document.getElementById('loadingState');
        this.successCard = document.getElementById('successCard');
        this.errorSection = document.getElementById('errorSection');
    }

    bindEvents() {
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));
    }

    async handleSubmit(e) {
        e.preventDefault();
        
        const formData = new FormData(this.form);
        const originalUrl = formData.get('originalUrl');
        const expiration = formData.get('expiration');
        
        // Validate URL
        if (!this.isValidUrl(originalUrl)) {
            this.showError('Please enter a valid URL starting with http:// or https://');
            return;
        }

        // Prepare request data
        const requestData = {
            originalUrl: originalUrl
        };

        // Handle expiration
        if (expiration) {
            const expirationDate = this.calculateExpirationDate(expiration);
            requestData.expiresAt = expirationDate.toISOString();
        }

        this.showLoading();
        this.hideError();

        try {
            const response = await fetch('/api/shorten', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            });

            const result = await response.json();

            if (result.success) {
                this.showSuccess(result.data);
                this.loadRecentUrls(); // Refresh recent URLs
            } else {
                throw new Error(result.error?.message || 'Failed to shorten URL');
            }
        } catch (error) {
            this.showError(error.message);
        } finally {
            this.hideLoading();
        }
    }

    calculateExpirationDate(expiration) {
        const now = new Date();
        switch (expiration) {
            case '1min':
                return new Date(now.getTime() + 60 * 1000);
            case '1h':
                return new Date(now.getTime() + 60 * 60 * 1000);
            case '1d':
                return new Date(now.getTime() + 24 * 60 * 60 * 1000);
            case '1w':
                return new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            case '1m':
                return new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
            default:
                return now;
        }
    }

    isValidUrl(string) {
        try {
            new URL(string);
            return true;
        } catch (_) {
            return false;
        }
    }

    showLoading() {
        this.loadingState.style.display = 'block';
        this.successCard.style.display = 'none';
        this.errorSection.style.display = 'none';
    }

    hideLoading() {
        this.loadingState.style.display = 'none';
    }

    showSuccess(data) {
        document.getElementById('shortUrlResult').value = data.shortUrl;
        document.getElementById('visitUrlBtn').href = data.shortUrl;
        document.getElementById('statsUrlBtn').href = `/${data.shortSlug}/stats`;
        document.getElementById('createdTime').textContent = new Date(data.createdAt).toLocaleString();
        document.getElementById('clickCount').textContent = data.clickCount;

        // Handle expiration display
        const expirationInfo = document.getElementById('expirationInfo');
        if (data.expiresAt) {
            document.getElementById('expirationTime').textContent = new Date(data.expiresAt).toLocaleString();
            expirationInfo.style.display = 'flex';
        } else {
            expirationInfo.style.display = 'none';
        }

        this.successCard.style.display = 'block';
        this.successCard.classList.add('animate-in');
        
        this.showToast('URL shortened successfully!', 'success');
    }

    showError(message) {
        document.getElementById('errorTitle').textContent = 'Error';
        document.getElementById('errorMessage').textContent = message;
        this.errorSection.style.display = 'block';
        this.showToast(message, 'error');
    }

    hideError() {
        this.errorSection.style.display = 'none';
    }

    async loadRecentUrls() {
        try {
            const response = await fetch('/api/urls/recent?limit=5');
            const result = await response.json();
            
            if (result.success && result.data.length > 0) {
                this.displayRecentUrls(result.data);
            } else {
                this.showEmptyRecentUrls();
            }
        } catch (error) {
            console.error('Failed to load recent URLs:', error);
        }
    }

    displayRecentUrls(urls) {
        const container = document.getElementById('recentUrlsContainer');
        const urlList = document.createElement('div');
        urlList.className = 'url-list enhanced';
        
        urls.forEach(url => {
            const urlItem = document.createElement('div');
            urlItem.className = 'url-item enhanced';
            urlItem.innerHTML = `
                <div class="url-info">
                    <div class="url-slug">/${url.shortSlug}</div>
                    <div class="url-original">${this.truncateUrl(url.originalUrl, 60)}</div>
                    ${url.expiresAt ? `
                        <div class="url-expiration">
                            <i class="fas fa-clock"></i>
                            Expires: ${new Date(url.expiresAt).toLocaleDateString()}
                        </div>
                    ` : ''}
                </div>
                <div class="url-meta">
                    <div class="click-info">
                        <span class="click-count">${url.clickCount}</span>
                        <span class="click-label">clicks</span>
                    </div>
                    <span class="url-time">${this.formatRelativeTime(url.createdAt)}</span>
                    <a href="/${url.shortSlug}/stats" class="btn btn-sm btn-outline">
                        <i class="fas fa-chart-line"></i>
                    </a>
                </div>
            `;
            urlList.appendChild(urlItem);
        });
        
        container.innerHTML = '';
        container.appendChild(urlList);
    }

    showEmptyRecentUrls() {
        const container = document.getElementById('recentUrlsContainer');
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-link"></i>
                </div>
                <h4 class="empty-title">No URLs Yet</h4>
                <p class="empty-subtitle">Create your first short URL above</p>
            </div>
        `;
    }

    truncateUrl(url, maxLength) {
        if (url.length <= maxLength) return url;
        return url.substring(0, maxLength - 3) + '...';
    }

    formatRelativeTime(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffInSeconds = Math.floor((now - date) / 1000);
        
        if (diffInSeconds < 60) return 'just now';
        if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
        if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
        return `${Math.floor(diffInSeconds / 86400)}d ago`;
    }

    showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
            <div class="toast-content">
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                <span>${message}</span>
            </div>
        `;
        
        const container = document.getElementById('toastContainer');
        container.appendChild(toast);
        
        setTimeout(() => {
            toast.classList.add('fade-out');
            setTimeout(() => {
                container.removeChild(toast);
            }, 300);
        }, 3000);
    }
}

// Global functions for compatibility
async function copyToClipboard() {
    const input = document.getElementById('shortUrlResult');
    const button = document.getElementById('copyBtn');
    
    try {
        await navigator.clipboard.writeText(input.value);
        button.innerHTML = '<i class="fas fa-check"></i>';
        button.classList.add('copy-success');
        
        setTimeout(() => {
            button.innerHTML = '<i class="fas fa-copy"></i>';
            button.classList.remove('copy-success');
        }, 2000);
        
        window.urlShortener.showToast('URL copied to clipboard!', 'success');
    } catch (err) {
        input.select();
        document.execCommand('copy');
        window.urlShortener.showToast('URL copied to clipboard!', 'success');
    }
}

function generateQRCode() {
    const shortUrl = document.getElementById('shortUrlResult').value;
    const qrCodeDisplay = document.getElementById('qrCodeDisplay');
    
    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(shortUrl)}`;
    qrCodeDisplay.innerHTML = `<img src="${qrUrl}" alt="QR Code" style="width: 100%; height: auto;">`;
    
    document.getElementById('qrModal').classList.add('show');
}

function closeQRModal() {
    document.getElementById('qrModal').classList.remove('show');
}

function downloadQRCode() {
    const shortUrl = document.getElementById('shortUrlResult').value;
    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(shortUrl)}`;
    const link = document.createElement('a');
    link.download = 'qr-code.png';
    link.href = qrUrl;
    link.click();
    window.urlShortener.showToast('QR Code downloaded!', 'success');
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    window.urlShortener = new URLShortener();
    
    // Make functions globally available
    window.copyToClipboard = copyToClipboard;
    window.generateQRCode = generateQRCode;
    window.closeQRModal = closeQRModal;
    window.downloadQRCode = downloadQRCode;
});
</script> 